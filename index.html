<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="基于MediaPipe手部追踪技术的网页画图应用">
    <meta name="keywords" content="手部追踪,画图,MediaPipe,手势识别,网页应用">
    <meta name="author" content="Hand Tracking Drawing App">
    
    <!-- 安全策略 -->
    <meta http-equiv="Permissions-Policy" content="camera=*">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval'; media-src 'self'; camera 'self';">
    
    <!-- PWA配置 -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <title>手部追踪画图应用 - 用手势进行创作</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- 预加载关键资源 -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" as="script">
    <link rel="preload" href="app.js" as="script">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎨</text></svg>">
</head>
<body>
    <div class="app-container">
        <!-- 头部工具栏 -->
        <header class="toolbar">
            <div class="tool-group">
                <button id="clearCanvas" class="tool-btn" title="清除画布 (快捷键: C)">清除画布</button>
                <button id="saveImage" class="tool-btn" title="保存图片">保存图片</button>
            </div>
            
            <!-- 画笔工具 -->
            <div class="tool-group">
                <button id="brushTool" class="tool-btn active" data-tool="brush" title="画笔工具 (快捷键: B)">画笔</button>
                <button id="eraserTool" class="tool-btn" data-tool="eraser" title="橡皮擦工具 (快捷键: E)">橡皮擦</button>
            </div>
            
            <!-- 画笔大小 -->
            <div class="tool-group">
                <label for="brushSize">画笔大小:</label>
                <input type="range" id="brushSize" min="1" max="20" value="5" title="调节画笔大小">
                <span id="brushSizeValue">5</span>
            </div>
            
            <!-- 调色板 -->
            <div class="tool-group color-palette">
                <div class="color-option active" data-color="#000000" style="background-color: #000000;" title="黑色"></div>
                <div class="color-option" data-color="#FF0000" style="background-color: #FF0000;" title="红色"></div>
                <div class="color-option" data-color="#00FF00" style="background-color: #00FF00;" title="绿色"></div>
                <div class="color-option" data-color="#0000FF" style="background-color: #0000FF;" title="蓝色"></div>
                <div class="color-option" data-color="#FFFF00" style="background-color: #FFFF00;" title="黄色"></div>
                <div class="color-option" data-color="#FF00FF" style="background-color: #FF00FF;" title="洋红"></div>
                <div class="color-option" data-color="#00FFFF" style="background-color: #00FFFF;" title="青色"></div>
                <div class="color-option" data-color="#FFA500" style="background-color: #FFA500;" title="橙色"></div>
                <div class="color-option" data-color="#800080" style="background-color: #800080;" title="紫色"></div>
                <div class="color-option" data-color="#FFC0CB" style="background-color: #FFC0CB;" title="粉色"></div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 摄像头绘画区域 -->
            <div class="camera-drawing-container">
                <video id="videoElement" autoplay muted playsinline></video>
                <canvas id="videoCanvas"></canvas>
                <canvas id="drawingCanvas"></canvas>
                
                <!-- 状态指示器 -->
                <div class="status-indicator">
                    <div id="handStatus" class="hand-status">等待手部检测...</div>
                    <div id="gestureStatus" class="gesture-status">手势: 无</div>
                </div>
                
                <!-- 绘画信息 -->
                <div class="drawing-info">
                    <div class="current-tool">工具: <span id="currentTool">画笔</span></div>
                    <div class="current-color">颜色: <span id="currentColor" style="background-color: #000000;"></span></div>
                </div>
            </div>
        </main>

        <!-- 手势说明 -->
        <aside class="gesture-guide">
            <h3>手势说明</h3>
            <div class="gesture-item">
                <span class="gesture-icon">✋</span>
                <span class="gesture-desc">张开手掌: 移动光标</span>
            </div>
            <div class="gesture-item">
                <span class="gesture-icon">👆</span>
                <span class="gesture-desc">食指指向: 绘画模式</span>
            </div>
            <div class="gesture-item">
                <span class="gesture-icon">✌️</span>
                <span class="gesture-desc">食指+中指: 点击/选择</span>
            </div>
            <div class="gesture-item">
                <span class="gesture-icon">👊</span>
                <span class="gesture-desc">握拳: 停止绘画</span>
            </div>
            
            <!-- 键盘快捷键说明 -->
            <div class="keyboard-shortcuts">
                <h4>快捷键</h4>
                <div class="shortcut-item">B - 画笔工具</div>
                <div class="shortcut-item">E - 橡皮擦</div>
                <div class="shortcut-item">C - 清除画布</div>
            </div>
        </aside>
    </div>

    <!-- 权限状态指示器 -->
    <div id="permissionStatus" class="permission-status">
        <div id="permissionText">权限状态检查中...</div>
    </div>

    <!-- 错误提示弹窗 -->
    <div id="errorModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>错误提示</h3>
            <p id="errorMessage"></p>
            <button id="retryButton" class="tool-btn">重试</button>
        </div>
    </div>

    <!-- 加载MediaPipe和应用脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="app.js"></script>
</body>
</html>